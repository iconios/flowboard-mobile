import { useCallback, useMemo } from "react";
import {
  View,
  StyleSheet,
  Text,
  FlatList,
} from "react-native";
import { useAppTheme } from "@/hooks/theme";
import SingleTask from "./single.task";
import { GetTaskType } from "@/types/tasks.types";

const ShowTasks = ({ tasks }: { tasks: GetTaskType[] }) => {
  // Initialize the variables and constants
  const theme = useAppTheme();

  // Styles object
  const styles = useMemo(
    () =>
      StyleSheet.create({
        loadingView: {
          flex: 1,
          justifyContent: "center",
          alignItems: "center",
          padding: 16,
        },
        loadingText: {
          marginTop: 16,
          ...theme.fonts.bodyMedium,
        },
        errorView: {
          flex: 1,
          justifyContent: "center",
          alignItems: "center",
          padding: 16,
        },
        errorMessage: {
          color: theme.colors.error,
          ...theme.fonts.bodyMedium,
        },
        refreshText: {
          color: theme.colors.primary,
          marginTop: 16,
        },
        emptyWrap: {
          flex: 1,
          alignItems: "center",
          justifyContent: "center",
          paddingVertical: 48,
          paddingHorizontal: 16,
        },
        emptyText: {
          textAlign: "center",
          opacity: 0.7,
          ...theme.fonts.bodyMedium,
        },
        separator: { height: 8 },
        listContent: {
          padding: 12,
          paddingBottom: 24,
          flexGrow: tasks.length === 0 ? 1 : 0,
        },
        footerSpacer: {
          height: 8,
        },
      }),
    [theme, tasks.length],
  );

  const SpacingSeparator = useCallback(
    () => <View style={styles.separator} />,
    [styles.separator],
  );

 return (
    <FlatList
      data={tasks}
      renderItem={({ item }) => (
        <SingleTask
          taskId={item._id}
          title={item.title}
          position={item.position}
          description={item.description}
          dueDate={item.dueDate}
          priority={item.priority}
          listId={item.listId}
        />
      )}
      keyExtractor={(item) => item._id}
      ListEmptyComponent={
        <View style={styles.emptyWrap}>
          <Text style={styles.emptyText}>
            You have not created any tasks for this list.
          </Text>
        </View>
      }
      initialNumToRender={4}
      ItemSeparatorComponent={SpacingSeparator}
      ListFooterComponent={<View style={styles.footerSpacer} />}
    />
  );
};

export default ShowTasks;
